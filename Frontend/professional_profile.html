<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Profile - ServiceBazaar</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="images/SB_Logo.png">
</head>
<body>

    <header class="navbar"></header>

    <main class="container" id="profileContainer">
        <p>Loading professional profile...</p>
    </main>

    <footer></footer>

    <script src="layout.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const profileContainer = document.getElementById('profileContainer');
            const urlParams = new URLSearchParams(window.location.search);
            const professionalId = urlParams.get('id');

            if (!professionalId) {
                profileContainer.innerHTML = '<p>No professional specified. <a href="services.html">Go back to services.</a></p>';
                return;
            }

            try {
                const res = await fetch(`${window.API_URL}/api/professionals/${professionalId}`);
                if (!res.ok) throw new Error('Could not fetch profile.');
                
                const professional = await res.json();

                profileContainer.innerHTML = ''; 

                const headerDiv = document.createElement('div');
                headerDiv.className = 'section-header';

                const nameH1 = document.createElement('h1');
                nameH1.textContent = professional.name; 

                const memberSinceP = document.createElement('p');
                memberSinceP.textContent = `Member since ${new Date(professional.createdAt).getFullYear()}`;

                headerDiv.appendChild(nameH1);
                headerDiv.appendChild(memberSinceP);
                profileContainer.appendChild(headerDiv);

                const servicesContainer = document.createElement('div');
                servicesContainer.className = 'profile-section';
                let servicesHTML = `<div class="section-header" style="text-align: left; margin-bottom: 2rem;"><h2>Services Offered</h2></div>`;
                if (professional.services && professional.services.length > 0) {
                    servicesHTML += '<div class="service-list">';
                    professional.services.forEach(service => {
                        servicesHTML += `<div class="service-list-item"><h3>${escapeHTML(service.service_name)}</h3><p>${escapeHTML(service.description)}</p><p class="price">₹${Number(service.price).toLocaleString('en-IN')}</p></div>`;
                    });
                    servicesHTML += '</div>';
                } else {
                    servicesHTML += '<p>This professional has not listed any services yet.</p>';
                }
                servicesContainer.innerHTML = servicesHTML;
                profileContainer.appendChild(servicesContainer);

                const reviewsContainer = document.createElement('div');
                reviewsContainer.className = 'profile-section';
                let reviewsHTML = `<div class="section-header" style="text-align: left; margin-bottom: 2rem;"><h2>Customer Reviews</h2></div>`;
                if (professional.reviews && professional.reviews.length > 0) {
                    reviewsHTML += '<div class="review-list">';
                    professional.reviews.forEach(review => {
                        reviewsHTML += `<div class="review-card"><div class="review-rating">${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</div><p class="review-comment">"${escapeHTML(review.comment)}"</p><p class="review-author">- ${escapeHTML(review.user_id.name)} on ${new Date(review.createdAt).toLocaleDateString()}</p></div>`;
                    });
                    reviewsHTML += '</div>';
                } else {
                    reviewsHTML += '<p>This professional has no reviews yet.</p>';
                }
                reviewsContainer.innerHTML = reviewsHTML;
                profileContainer.appendChild(reviewsContainer);

                function escapeHTML(str) {
                    const p = document.createElement('p');
                    p.textContent = str;
                    return p.innerHTML;
                }
            } catch (error) {
                profileContainer.innerHTML = `<p>Error loading profile: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>